{"version":3,"file":"browser-peer.js","sources":["../src/util/uuid.js","../src/util/get-browser-rtc.js","../src/util/ipvx.js","../src/util/is-type.js","../src/event-emitter.js","../src/peer.js"],"sourcesContent":["export default function uuid () {\n  var uuid = ''\n  var i\n  var random\n  for (i = 0; i < 32; i++) {\n    random = Math.random() * 16 | 0\n\n    if (i === 8 || i === 12 || i === 16 || i === 20) {\n      uuid += '-'\n    }\n    uuid += (i === 12 ? 4 : (i === 16 ? (random & 3 | 8) : random)).toString(16)\n  }\n  return uuid\n}\n","// originally pulled out of simple-peer\n// TODO: Add copyright: https://github.com/substack/get-browser-rtc\nexport default function getBrowserRTC () {\n  if (typeof window === 'undefined') return null\n  var wrtc = {\n    RTCPeerConnection: window.RTCPeerConnection || window.mozRTCPeerConnection ||\n      window.webkitRTCPeerConnection,\n    RTCSessionDescription: window.RTCSessionDescription ||\n      window.mozRTCSessionDescription || window.webkitRTCSessionDescription,\n    RTCIceCandidate: window.RTCIceCandidate || window.mozRTCIceCandidate ||\n      window.webkitRTCIceCandidate\n  }\n  if (!wrtc.RTCPeerConnection) return null\n  return wrtc\n}\n","/**\n * @private\n * @function ipVersion\n * @description Returns the IP verison string or throws an error if the IP is\n *   invalid.\n * @param {string} ip IP address\n * @returns {string} The IP address version `IPv4|IPv6`.\n */\nexport default function ipVersion (ip) {\n  let reIPv4 = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/\n  let reIPv6 = /(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/\n\n  if (reIPv4.test(ip)) {\n    return 'IPv4'\n  } else if (reIPv6.test(ip)) {\n    return 'IPv6'\n  } else {\n    throw new Error(ip + ' is not a valid IPv4 or IPv6 address.')\n  }\n}\n","export function isFunction (arg) {\n  return typeof arg === 'function'\n}\n\nexport function isNumber (arg) {\n  return typeof arg === 'number'\n}\n\nexport function isObject (arg) {\n  return typeof arg === 'object' && arg !== null\n}\n\nexport function isUndefined (arg) {\n  return arg === void 0\n}\n","import {isFunction} from './util/is-type.js'\n\n// TODO: Strip out into own module\n\n/** Emulates Node.js event pub/sub pattern */\nexport default class EventEmitter {\n  constructor () {\n    this._eventMap = new Map()\n  }\n\n  addListener (labelString, callback) {\n    if (!isFunction(callback)) throw new TypeError('listener must be a function')\n    let labels = labelString.split(' ')\n\n    labels.forEach(label => {\n      if (!this._eventMap.has(label)) this._eventMap.set(label, [])\n      this.listeners(label).push(callback)\n    })\n\n    return this\n  }\n  on () { return this.addListener(...arguments) }\n\n  once (label, callback) {\n    if (!isFunction(callback)) throw new TypeError('listener must be a function')\n\n    var fired = false\n\n    function g () {\n      this.removeListener(label, g)\n\n      if (!fired) {\n        fired = true\n        callback.apply(this, arguments)\n      }\n    }\n\n    g.callback = callback\n    this.on(label, g)\n\n    return this\n  }\n\n  removeListener (label, callback) {\n    if (!isFunction(callback)) throw new TypeError('listener must be a function')\n\n    let currentListeners = this.listeners(label)\n    let newListeners = currentListeners.filter(listener => listener !== callback)\n\n    if (currentListeners !== newListeners) {\n      this._eventMap.set(label, newListeners)\n      return this\n    }\n  }\n  off () { return this.removeListener(...arguments) }\n\n  removeAllListeners (type) {\n    return this._eventMap.delete(type)\n  }\n\n  emit (label, ...args) {\n    let listeners = this.listeners(label)\n\n    if (listeners && listeners.length) {\n      listeners.forEach(listener => listener.apply(this, args))\n      return this\n    }\n  }\n\n  listeners (type) {\n    return this._eventMap.get(type)\n  }\n\n  static listenerCount (emitter, type) {\n    return emitter.listenerCount(type)\n  }\n}\n","import uuid from './util/uuid.js'\nimport getBrowserRTC from './util/get-browser-rtc.js'\nimport ipVersion from './util/ipvx.js'\nimport EventEmitter from './event-emitter.js'\n\nconst MAX_BUFFERED_AMOUNT = 64 * 1024\nconst CHROMIUM = typeof window !== 'undefined' && !!window.webkitRTCPeerConnection\n\n/**\n * @typedef PeerOptions\n * @type {Object}\n * @property {boolean} initiator Set to true if this local peer is the initiator\n *   of the connection.\n * @property {boolean} [allowHalfOpen=false]\n * @property {boolean} [debug=false] Set to true to log debug messages.\n */\n\n/**\n * Represents a P2P connection.\n * @extends EventEmitter\n */\nexport default class Peer extends EventEmitter {\n  /**\n   * Creates a new P2P connection and sets up internal WebRTC events.\n   * @param {PeerOptions} opts\n   */\n  constructor (opts) {\n    super()\n    this._id = uuid().substr(0, 8)\n    // self._debug('new peer %o', opts)\n\n    this.opts = Object.assign({\n      allowHalfOpen: false,\n      debug: false\n    }, opts)\n\n    this.channelName = this.opts.initiator\n      ? this.opts.channelName || uuid()\n      : null\n\n    this.initiator = this.opts.initiator || false\n    this.channelConfig = this.opts.channelConfig || Peer.channelConfig\n    this.config = this.opts.config || Peer.config\n    this.constraints = Peer.transformConstraints(this.opts.constraints || Peer.constraints)\n    this.offerConstraints = Peer.transformConstraints(this.opts.offerConstraints || {})\n    this.answerConstraints = Peer.transformConstraints(this.opts.answerConstraints || {})\n    this.reconnectTimer = this.opts.reconnectTimer || false\n    this.sdpTransform = this.opts.sdpTransform || function (sdp) { return sdp }\n    this.stream = this.opts.stream || false\n    this.trickle = this.opts.trickle !== undefined ? this.opts.trickle : true\n    this._earlyMessage = null\n\n    this.destroyed = false\n    this.connected = false\n\n    this.remoteAddress = undefined\n    this.remoteFamily = undefined\n    this.remotePort = undefined\n    this.localAddress = undefined\n    this.localPort = undefined\n\n    this._wrtc = (this.opts.wrtc && typeof this.opts.wrtc === 'object')\n      ? this.opts.wrtc\n      : getBrowserRTC()\n\n    if (!this._wrtc) {\n      throw new Error('No WebRTC support: Not a supported browser')\n    }\n\n    this._pcReady = false\n    this._channelReady = false\n    this._iceComplete = false // ice candidate trickle done (got null candidate)\n    this._channel = null\n    this._pendingCandidates = []\n    this._previousStreams = []\n\n    this._chunk = null\n    this._cb = null\n    this._interval = null\n    this._reconnectTimeout = null\n\n    this._pc = new (this._wrtc.RTCPeerConnection)(this.config, this.constraints)\n\n    this._pc.oniceconnectionstatechange = () => {\n      this._onIceStateChange()\n    }\n    this._pc.onicegatheringstatechange = () => {\n      this._onIceStateChange()\n    }\n    this._pc.onsignalingstatechange = () => {\n      this._onSignalingStateChange()\n    }\n    this._pc.onicecandidate = (event) => {\n      this._onIceCandidate(event)\n    }\n\n    // Other spec events, unused by this implementation:\n    // - onconnectionstatechange\n    // - onicecandidateerror\n    // - onfingerprintfailure\n\n    if (this.initiator) {\n      let createdOffer = false\n      this._pc.onnegotiationneeded = () => {\n        if (!createdOffer) this._createOffer()\n        createdOffer = true\n      }\n\n      this._setupData({\n        channel: this._pc.createDataChannel(this.channelName, this.channelConfig)\n      })\n    } else {\n      this._pc.ondatachannel = (event) => {\n        this._setupData(event)\n      }\n    }\n\n    if ('addTrack' in this._pc) {\n      this._pc.ontrack = (event) => {\n        this._onTrack(event)\n      }\n    } else {\n      // This can be removed once all browsers support `ontrack`\n      // Further reading: https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addStream\n      this._pc.onaddstram = (event) => {\n        this._onAddStram(event)\n      }\n    }\n    // HACK: wrtc doesn't fire the 'negotionneeded' event\n    if (this.initiator && this._isWrtc) {\n      this._pc.onnegotiationneeded()\n    }\n\n    this._onFinishBound = () => {\n      this._onFinish()\n    }\n    this.once('finish', this._onFinishBound)\n  } // END CONSTRUCTOR\n\n  /**\n   * Default WebRTC config.\n   * @constant\n   * @type {Object}\n   * @default // { iceServers: [ { urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:global.stun.twilio.com:3478?transport=udp' } ] }\n   */\n  static get config () {\n    return {\n      iceServers: [\n        {\n          urls: 'stun:stun.l.google.com:19302'\n        },\n        {\n          urls: 'stun:global.stun.twilio.com:3478?transport=udp'\n        }\n      ]\n    }\n  }\n\n  /**\n   * Flag which returns true if the current environment supports WebRTC\n   * @constant\n   * @type {boolean}\n   */\n  static get WEBRTC_SUPPORT () {\n    return !!getBrowserRTC()\n  }\n\n  /**\n   * @constant\n   * @type {Object}\n   * @default // {}\n   */\n  static get channelConfig () { return {} }\n\n  /**\n   * @constant\n   * @type {Object}\n   * @default // {}\n   */\n  static get constraints () { return {} }\n\n  /**\n   * Transform constraints objects into the new format (unless Chromium)\n   * TODO: This can be removed when Chromium supports the new format\n   */\n  static transformConstraints (constraints) {\n    if (Object.keys(constraints).length === 0) {\n      return constraints\n    }\n\n    if ((constraints.mandatory || constraints.optional) && !CHROMIUM) {\n      // convert to new format\n\n      // Merge mandatory and optional objects, prioritizing mandatory\n      var newConstraints = Object.assign({}, constraints.optional, constraints.mandatory)\n\n      // fix casing\n      if (newConstraints.OfferToReceiveVideo !== undefined) {\n        newConstraints.offerToReceiveVideo = newConstraints.OfferToReceiveVideo\n        delete newConstraints['OfferToReceiveVideo']\n      }\n\n      if (newConstraints.OfferToReceiveAudio !== undefined) {\n        newConstraints.offerToReceiveAudio = newConstraints.OfferToReceiveAudio\n        delete newConstraints['OfferToReceiveAudio']\n      }\n\n      return newConstraints\n    } else if (!constraints.mandatory && !constraints.optional && CHROMIUM) {\n      // convert to old format\n\n      // fix casing\n      if (constraints.offerToReceiveVideo !== undefined) {\n        constraints.OfferToReceiveVideo = constraints.offerToReceiveVideo\n        delete constraints['offerToReceiveVideo']\n      }\n\n      if (constraints.offerToReceiveAudio !== undefined) {\n        constraints.OfferToReceiveAudio = constraints.offerToReceiveAudio\n        delete constraints['offerToReceiveAudio']\n      }\n\n      return {\n        mandatory: constraints // NOTE: All constraints are upgraded to mandatory\n      }\n    }\n\n    return constraints\n  }\n\n  /**\n   * Getter for the `[RTCDataChannel.bufferedAmount]{@link https://developer.mozilla.org/en-US/docs/Web/API/RTCDataChannel/bufferedAmount}`\n   * property.\n   * @type {number}\n   * @default 0\n   */\n  get bufferSize () {\n    return (this._channel && this._channel.bufferedAmount) || 0\n  }\n\n  /**\n   * @typedef {Object} PeerAddress\n   * @property {number} port\n   * @property {string} family\n   * @property {string} address\n   */\n\n  /**\n   * Returns the local `PeerAddress`\n   * @type {PeerAddress}\n   */\n  get address () {\n    return {\n      port: this.localPort,\n      family: ipVersion(this.localAddress),\n      address: this.localAddress\n    }\n  }\n\n  /**\n   * `[RTCSessionDescription]{@link https://developer.mozilla.org/en-US/docs/Web/API/RTCSessionDescription}`\n   * @typedef RTCSessionDescription\n   * @type {Object}\n   */\n\n  /**\n   * The signal method attempts to setup the P2P connection using the proposed\n   * candidates.\n   * @param {RTCSessionDescription} data The signalling data\n   */\n  signal (data) {\n    if (this.destroyed) throw new Error('cannot signal after peer is destroyed')\n    if (typeof data === 'string') {\n      try {\n        data = JSON.parse(data)\n      } catch (err) {\n        data = {}\n      }\n    }\n    // self._debug('signal()')\n\n    if (data.candidate) {\n      if (this._pc.remoteDescription) this._addIceCandidate(data.candidate)\n      else this._pendingCandidates.push(data.candidate)\n    }\n    if (data.sdp) {\n      this._pc.setRemoteDescription(new (this._wrtc.RTCSessionDescription)(data), () => {\n        if (this.destroyed) return\n\n        this._pendingCandidates.forEach(candidate => this._addIceCandidate(candidate))\n        this._pendingCandidates = []\n\n        if (this._pc.remoteDescription.type === 'offer') this._createAnswer()\n      }, (err) => { this._destroy(err) })\n    }\n    if (!data.sdp && !data.candidate) {\n      this._destroy(new Error('signal() called with invalid signal data'))\n    }\n  }\n\n  /**\n  * Send text/binary data to the remote peer.\n  * @param {TypedArrayView|ArrayBuffer|Buffer|string|Blob|Object} chunk\n  */\n  send (chunk) {\n    this._channel.send(chunk)\n  }\n\n  /**\n   * Destroys the connections and socket.\n   * @param {function} onclose On close callback\n   */\n  destroy (onclose) {\n    this._destroy(null, onclose)\n  }\n\n  /**\n   * @callback getStatsCallback\n   * @param {?Error} err\n   * @param {Array} reports\n   */\n\n  /**\n   * Wraps the promise based `RTCRtpSender.getStats()` method in a callback\n   * based approach.\n   * @param {getStatsCallback} cb Callback that handles the response\n   */\n  getStats (cb) {\n    // Promise-based getStats() (standard)\n    if (this._pc.getStats.length === 0) {\n      this._pc.getStats().then(function (res) {\n        var reports = []\n        res.forEach(function (report) {\n          reports.push(report)\n        })\n        cb(null, reports)\n      }, function (err) { cb(err) })\n\n      // Single-parameter callback-based getStats() (non-standard)\n    } else if (this._pc.getStats.length > 0) {\n      this._pc.getStats(function (res) {\n        // If we destroy connection in `connect` callback this code might happen to run when actual connection is already closed\n        if (this.destroyed) return\n\n        var reports = []\n        res.result().forEach(function (result) {\n          var report = {}\n          result.names().forEach(function (name) {\n            report[name] = result.stat(name)\n          })\n          report.id = result.id\n          report.type = result.type\n          report.timestamp = result.timestamp\n          reports.push(report)\n        })\n        cb(null, reports)\n      }, function (err) { cb(err) })\n\n      // Unknown browser, skip getStats() since it's anyone's guess which style of\n      // getStats() they implement.\n    } else {\n      cb(null, [])\n    }\n  }\n\n  // ***** PRIVATE METHODS ***** //\n\n  /**\n   * @private\n   * A wrapper for the `[RTCPeerConnection.addIceCandidate()]{@link https://developer.mozilla.org/en-US/docs/Web/API/RTCIceCandidate}`\n   * method.\n   * @param {Object} candidate An object conforming to the RTCIceCandidateInit\n   *  dictionary.\n   */\n  _addIceCandidate (candidate) {\n    try {\n      this._pc.addIceCandidate(\n        new this._wrtc.RTCIceCandidate(candidate),\n        noop,\n        function (err) { this._destroy(err) }\n      )\n    } catch (err) {\n      this._destroy(new Error('error adding candidate: ' + err.message))\n    }\n  }\n\n  /**\n   * @private\n   * Method which destroys the socket and connection when an error occurs.\n   * Can be called using the public method `Peer.destroy()`. Catch these errors\n   * by creating a `Peer.on('error', handler)` event handler.\n   * @param {?Error} err The error that occured.\n   * @param {function} onclose On close callback\n   */\n  _destroy (err, onclose) {\n    if (this.destroyed) return\n    if (onclose) this.once('close', onclose)\n\n    this._debug('destroy (error: %s)', err && (err.message || err))\n\n    // this.readable = this.writable = false\n    //\n    // if (!self._readableState.ended) self.push(null)\n    // if (!self._writableState.finished) self.end()\n\n    this.destroyed = true\n    this.connected = false\n    this._pcReady = false\n    this._channelReady = false\n    this._previousStreams = null\n    this._earlyMessage = null\n\n    clearInterval(this._interval)\n    clearTimeout(this._reconnectTimeout)\n    this._interval = null\n    this._reconnectTimeout = null\n    this._chunk = null\n    this._cb = null\n\n    if (this._onFinishBound) this.off('finish', this._onFinishBound)\n    this._onFinishBound = null\n\n    if (this._pc) {\n      try {\n        this._pc.close()\n      } catch (err) {}\n\n      this._pc.oniceconnectionstatechange = null\n      this._pc.onicegatheringstatechange = null\n      this._pc.onsignalingstatechange = null\n      this._pc.onicecandidate = null\n      if ('addTrack' in this._pc) {\n        this._pc.ontrack = null\n      } else {\n        this._pc.onaddstream = null\n      }\n      this._pc.onnegotiationneeded = null\n      this._pc.ondatachannel = null\n    }\n\n    if (this._channel) {\n      try {\n        this._channel.close()\n      } catch (err) {}\n\n      this._channel.onmessage = null\n      this._channel.onopen = null\n      this._channel.onclose = null\n      this._channel.onerror = null\n    }\n    this._pc = null\n    this._channel = null\n\n    if (err) this.emit('error', err)\n    this.emit('close')\n  }\n\n  /**\n   * @private\n   * Setup a new Data Channel along with the appropriate callbacks\n   * @param {Object} event A `[datachannel]{@link https://developer.mozilla.org/en-US/docs/Web/Events/datachannel}`\n   *   event with at least a `channel` property.\n   */\n  _setupData (event) {\n    if (!event.channel) {\n      // In some situations `pc.createDataChannel()` returns `undefined` (in wrtc),\n      // which is invalid behavior. Handle it gracefully.\n      // See: https://github.com/feross/simple-peer/issues/163\n      return this._destroy(new Error('Data channel event is missing `channel` property'))\n    }\n\n    this._channel = event.channel\n    this._channel.binaryType = 'arraybuffer'\n\n    if (typeof this._channel.bufferedAmountLowThreshold === 'number') {\n      this._channel.bufferedAmountLowThreshold = MAX_BUFFERED_AMOUNT\n    }\n\n    this.channelName = this._channel.label\n\n    this._channel.onmessage = (event) => {\n      if (!this._channelReady) { // HACK: Workaround for Chrome not firing \"open\" between tabs\n        this._earlyMessage = event\n        this._onChannelOpen()\n      } else {\n        this._onChannelMessage(event)\n      }\n    }\n    this._channel.onbufferedamountlow = () => {\n      this._onChannelBufferedAmountLow()\n    }\n    this._channel.onopen = () => {\n      if (!this._channelReady) this._onChannelOpen()\n    }\n    this._channel.onclose = () => {\n      this._onChannelClose()\n    }\n    this._channel.onerror = (err) => {\n      this._destroy(err)\n    }\n  }\n\n  // FIXME: This is legacy code from simple-peer. Is it needed?\n  _write (chunk, encoding, cb) {\n    if (this.destroyed) return cb(new Error('cannot write after peer is destroyed'))\n\n    if (this.connected) {\n      try {\n        this.send(chunk)\n      } catch (err) {\n        return this._destroy(err)\n      }\n      if (this._channel.bufferedAmount > MAX_BUFFERED_AMOUNT) {\n        this._debug('start backpressure: bufferedAmount %d', this._channel.bufferedAmount)\n        this._cb = cb\n      } else {\n        cb(null)\n      }\n    } else {\n      this._debug('write before connect')\n      this._chunk = chunk\n      this._cb = cb\n    }\n  }\n\n  _createOffer () {\n    if (this.destroyed) return\n\n    this._pc.createOffer((offer) => {\n      var onSuccess = () => {\n        if (this.destroyed) return\n        if (this.trickle || this._iceComplete) sendOffer()\n        else this.once('_iceComplete', sendOffer) // wait for candidates\n      }\n\n      var sendOffer = () => {\n        var signal = this._pc.localDescription || offer\n        this._debug('signal')\n        this.emit('signal', {\n          type: signal.type,\n          sdp: signal.sdp\n        })\n      }\n\n      var onError = (err) => {\n        this._destroy(err)\n      }\n\n      if (this.destroyed) return\n      offer.sdp = this.sdpTransform(offer.sdp)\n      this._pc.setLocalDescription(offer, onSuccess, onError)\n    }, function (err) { this._destroy(err) }, this.offerConstraints)\n  }\n\n  _createAnswer () {\n    if (this.destroyed) return\n\n    this._pc.createAnswer((answer) => {\n      var onSuccess = () => {\n        if (this.destroyed) return\n        if (this.trickle || this._iceComplete) sendAnswer()\n        else this.once('_iceComplete', sendAnswer)\n      }\n\n      var sendAnswer = () => {\n        var signal = this._pc.localDescription || answer\n        this._debug('signal')\n        this.emit('signal', {\n          type: signal.type,\n          sdp: signal.sdp\n        })\n      }\n\n      var onError = (err) => {\n        this._destroy(err)\n      }\n\n      if (this.destroyed) return\n      answer.sdp = this.sdpTransform(answer.sdp)\n      this._pc.setLocalDescription(answer, onSuccess, onError)\n    }, function (err) { this._destroy(err) }, this.answerConstraints)\n  }\n\n  _onIceStateChange () {\n    if (this.destroyed) return\n    var iceConnectionState = this._pc.iceConnectionState\n    var iceGatheringState = this._pc.iceGatheringState\n\n    this._debug(\n      'iceStateChange (connection: %s) (gathering: %s)',\n      iceConnectionState,\n      iceGatheringState\n    )\n    this.emit('iceStateChange', iceConnectionState, iceGatheringState)\n\n    if (iceConnectionState === 'connected' || iceConnectionState === 'completed') {\n      clearTimeout(this._reconnectTimeout)\n      this._pcReady = true\n      this._maybeReady()\n    }\n    if (iceConnectionState === 'disconnected') {\n      if (this.reconnectTimer) {\n        // If user has set `opt.reconnectTimer`, allow time for ICE to attempt a reconnect\n        clearTimeout(this._reconnectTimeout)\n        this._reconnectTimeout = setTimeout(function () {\n          this._destroy()\n        }, this.reconnectTimer)\n      } else {\n        this._destroy()\n      }\n    }\n    if (iceConnectionState === 'failed') {\n      this._destroy(new Error('Ice connection failed.'))\n    }\n    if (iceConnectionState === 'closed') {\n      this._destroy()\n    }\n  }\n\n  _maybeReady () {\n    this._debug('maybeReady pc %s channel %s', this._pcReady, this._channelReady)\n    if (this.connected || this._connecting || !this._pcReady || !this._channelReady) return\n\n    this._connecting = true\n\n    // HACK: We can't rely on order here, for details see https://github.com/js-platform/node-webrtc/issues/339\n    var findCandidatePair = () => {\n      if (this.destroyed) return\n\n      this.getStats((err, items) => {\n        if (this.destroyed) return\n\n        // Treat getStats error as non-fatal. It's not essential.\n        if (err) items = []\n\n        var remoteCandidates = {}\n        var localCandidates = {}\n        var candidatePairs = {}\n        var foundSelectedCandidatePair = false\n\n        var setSelectedCandidatePair = (selectedCandidatePair) => {\n          foundSelectedCandidatePair = true\n\n          var local = localCandidates[selectedCandidatePair.localCandidateId]\n\n          if (local && local.ip) {\n            // Spec\n            this.localAddress = local.ip\n            this.localPort = Number(local.port)\n          } else if (local && local.ipAddress) {\n            // Firefox\n            this.localAddress = local.ipAddress\n            this.localPort = Number(local.portNumber)\n          } else if (typeof selectedCandidatePair.googLocalAddress === 'string') {\n            // TODO: remove this once Chrome 58 is released\n            local = selectedCandidatePair.googLocalAddress.split(':')\n            this.localAddress = local[0]\n            this.localPort = Number(local[1])\n          }\n\n          var remote = remoteCandidates[selectedCandidatePair.remoteCandidateId]\n\n          if (remote && remote.ip) {\n            // Spec\n            this.remoteAddress = remote.ip\n            this.remotePort = Number(remote.port)\n          } else if (remote && remote.ipAddress) {\n            // Firefox\n            this.remoteAddress = remote.ipAddress\n            this.remotePort = Number(remote.portNumber)\n          } else if (typeof selectedCandidatePair.googRemoteAddress === 'string') {\n            // TODO: remove this once Chrome 58 is released\n            remote = selectedCandidatePair.googRemoteAddress.split(':')\n            this.remoteAddress = remote[0]\n            this.remotePort = Number(remote[1])\n          }\n          this.remoteFamily = 'IPv4'\n\n          this._debug(\n            'connect local: %s:%s remote: %s:%s',\n            this.localAddress, this.localPort, this.remoteAddress, this.remotePort\n          )\n        }\n\n        items.forEach(function (item) {\n          // TODO: Once all browsers support the hyphenated stats report types, remove the non-hypenated ones\n          if (item.type === 'remotecandidate' || item.type === 'remote-candidate') {\n            remoteCandidates[item.id] = item\n          }\n          if (item.type === 'localcandidate' || item.type === 'local-candidate') {\n            localCandidates[item.id] = item\n          }\n          if (item.type === 'candidatepair' || item.type === 'candidate-pair') {\n            candidatePairs[item.id] = item\n          }\n        })\n\n        items.forEach(function (item) {\n          // Spec-compliant\n          if (item.type === 'transport') {\n            setSelectedCandidatePair(candidatePairs[item.selectedCandidatePairId])\n          }\n\n          // Old implementations\n          if (\n            (item.type === 'googCandidatePair' && item.googActiveConnection === 'true') ||\n            ((item.type === 'candidatepair' || item.type === 'candidate-pair') && item.selected)\n          ) {\n            setSelectedCandidatePair(item)\n          }\n        })\n\n        if (!foundSelectedCandidatePair && items.length) {\n          setTimeout(findCandidatePair, 100)\n          return\n        } else {\n          this._connecting = false\n          this.connected = true\n        }\n\n        if (this._chunk) {\n          try {\n            this.send(this._chunk)\n          } catch (err) {\n            return this._destroy(err)\n          }\n          this._chunk = null\n          this._debug('sent chunk from \"write before connect\"')\n\n          var cb = this._cb\n          this._cb = null\n          cb(null)\n        }\n\n        // If `bufferedAmountLowThreshold` and 'onbufferedamountlow' are unsupported,\n        // fallback to using setInterval to implement backpressure.\n        if (typeof this._channel.bufferedAmountLowThreshold !== 'number') {\n          this._interval = setInterval(this._onInterval, 150)\n          if (this._interval.unref) this._interval.unref()\n        }\n\n        this._debug('connect')\n        this.emit('connect')\n        if (this._earlyMessage) { // HACK: Workaround for Chrome not firing \"open\" between tabs\n          this._onChannelMessage(this._earlyMessage)\n          this._earlyMessage = null\n        }\n      })\n    }\n    findCandidatePair()\n  }\n\n  // ***** CALLBACKS ***** //\n\n  _onFinish () {\n    if (this.destroyed) return\n\n    if (this.connected) {\n      destroySoon()\n    } else {\n      this.once('connect', destroySoon)\n    }\n\n    // Wait a bit before destroying so the socket flushes.\n    // TODO: is there a more reliable way to accomplish this?\n    function destroySoon () {\n      setTimeout(function () {\n        this._destroy()\n      }, 1000)\n    }\n  }\n\n  _onInterval () {\n    if (!this._cb || !this._channel || this._channel.bufferedAmount > MAX_BUFFERED_AMOUNT) {\n      return\n    }\n    this._onChannelBufferedAmountLow()\n  }\n\n  _onSignalingStateChange () {\n    if (this.destroyed) return\n    this._debug('signalingStateChange %s', this._pc.signalingState)\n    this.emit('signalingStateChange', this._pc.signalingState)\n  }\n\n  _onIceCandidate (event) {\n    if (this.destroyed) return\n    if (event.candidate && this.trickle) {\n      this.emit('signal', {\n        candidate: {\n          candidate: event.candidate.candidate,\n          sdpMLineIndex: event.candidate.sdpMLineIndex,\n          sdpMid: event.candidate.sdpMid\n        }\n      })\n    } else if (!event.candidate) {\n      this._iceComplete = true\n      this.emit('_iceComplete')\n    }\n  }\n\n  _onChannelMessage (event) {\n    if (this.destroyed) return\n    var data = event.data\n    if (data instanceof ArrayBuffer) data = Buffer.from(data)\n    this.emit('data', data)\n  }\n\n  _onChannelBufferedAmountLow () {\n    if (this.destroyed || !this._cb) return\n    this._debug('ending backpressure: bufferedAmount %d', this._channel.bufferedAmount)\n    var cb = this._cb\n    this._cb = null\n    cb(null)\n  }\n\n  _onChannelOpen () {\n    var self = this\n    if (self.connected || self.destroyed) return\n    // self._debug('on channel open')\n    self._channelReady = true\n    self._maybeReady()\n  }\n\n  _onChannelClose () {\n    if (this.destroyed) return\n    this._debug('on channel close')\n    this._destroy()\n  }\n\n  _onTrack (event) {\n    if (this.destroyed) return\n    this._debug('on track')\n    var id = event.streams[0].id\n    if (this._previousStreams.indexOf(id) !== -1) return // Only fire one 'stream' event, even though there may be multiple tracks per stream\n    this._previousStreams.push(id)\n    this.emit('stream', event.streams[0])\n  }\n\n  _debug (msg) { if (this.opts.debug) console.debug(msg) }\n}\n\nfunction noop () {}\n"],"names":["uuid","i","random","Math","toString","getBrowserRTC","window","wrtc","RTCPeerConnection","mozRTCPeerConnection","webkitRTCPeerConnection","RTCSessionDescription","mozRTCSessionDescription","webkitRTCSessionDescription","RTCIceCandidate","mozRTCIceCandidate","webkitRTCIceCandidate","ipVersion","ip","reIPv4","reIPv6","test","Error","isFunction","arg","EventEmitter","_eventMap","Map","labelString","callback","TypeError","labels","split","forEach","has","label","set","listeners","push","addListener","arguments","fired","g","removeListener","apply","on","currentListeners","newListeners","filter","listener","type","delete","args","length","get","emitter","listenerCount","MAX_BUFFERED_AMOUNT","CHROMIUM","Peer","opts","_id","substr","Object","assign","channelName","initiator","channelConfig","config","constraints","transformConstraints","offerConstraints","answerConstraints","reconnectTimer","sdpTransform","sdp","stream","trickle","undefined","_earlyMessage","destroyed","connected","remoteAddress","remoteFamily","remotePort","localAddress","localPort","_wrtc","_pcReady","_channelReady","_iceComplete","_channel","_pendingCandidates","_previousStreams","_chunk","_cb","_interval","_reconnectTimeout","_pc","oniceconnectionstatechange","_onIceStateChange","onicegatheringstatechange","onsignalingstatechange","_onSignalingStateChange","onicecandidate","event","_onIceCandidate","createdOffer","onnegotiationneeded","_createOffer","_setupData","createDataChannel","ondatachannel","ontrack","_onTrack","onaddstram","_onAddStram","_isWrtc","_onFinishBound","_onFinish","once","data","JSON","parse","err","candidate","remoteDescription","_addIceCandidate","setRemoteDescription","_createAnswer","_destroy","chunk","send","onclose","cb","getStats","then","res","reports","report","result","names","name","stat","id","timestamp","addIceCandidate","noop","message","_debug","off","close","onaddstream","onmessage","onopen","onerror","emit","channel","binaryType","bufferedAmountLowThreshold","_onChannelOpen","_onChannelMessage","onbufferedamountlow","_onChannelBufferedAmountLow","_onChannelClose","encoding","bufferedAmount","createOffer","offer","onSuccess","sendOffer","signal","localDescription","onError","setLocalDescription","createAnswer","answer","sendAnswer","iceConnectionState","iceGatheringState","_maybeReady","setTimeout","_connecting","findCandidatePair","items","remoteCandidates","localCandidates","candidatePairs","foundSelectedCandidatePair","setSelectedCandidatePair","selectedCandidatePair","local","localCandidateId","Number","port","ipAddress","portNumber","googLocalAddress","remote","remoteCandidateId","googRemoteAddress","item","selectedCandidatePairId","googActiveConnection","selected","setInterval","_onInterval","unref","destroySoon","signalingState","sdpMLineIndex","sdpMid","ArrayBuffer","Buffer","from","self","streams","indexOf","msg","debug","console","keys","mandatory","optional","newConstraints","OfferToReceiveVideo","offerToReceiveVideo","OfferToReceiveAudio","offerToReceiveAudio"],"mappings":"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"}