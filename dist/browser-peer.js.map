{"version":3,"file":"browser-peer.js","sources":["../src/util/uuid.js","../src/util/get-browser-rtc.js","../src/util/ipvx.js","../src/util/is-type.js","../src/event-emitter.js","../src/peer.js"],"sourcesContent":["export default function uuid () {\n  var uuid = ''\n  var i\n  var random\n  for (i = 0; i < 32; i++) {\n    random = Math.random() * 16 | 0\n\n    if (i === 8 || i === 12 || i === 16 || i === 20) {\n      uuid += '-'\n    }\n    uuid += (i === 12 ? 4 : (i === 16 ? (random & 3 | 8) : random)).toString(16)\n  }\n  return uuid\n}\n","// originally pulled out of simple-peer\n// TODO: Add copyright: https://github.com/substack/get-browser-rtc\nexport default function getBrowserRTC () {\n  if (typeof window === 'undefined') return null\n  var wrtc = {\n    RTCPeerConnection: window.RTCPeerConnection || window.mozRTCPeerConnection ||\n      window.webkitRTCPeerConnection,\n    RTCSessionDescription: window.RTCSessionDescription ||\n      window.mozRTCSessionDescription || window.webkitRTCSessionDescription,\n    RTCIceCandidate: window.RTCIceCandidate || window.mozRTCIceCandidate ||\n      window.webkitRTCIceCandidate\n  }\n  if (!wrtc.RTCPeerConnection) return null\n  return wrtc\n}\n","/**\n * @private\n * @function ipVersion\n * @description Returns the IP verison string or throws an error if the IP is\n *   invalid.\n * @param {string} ip IP address\n * @returns {string} The IP address version `IPv4|IPv6`.\n */\nexport default function ipVersion (ip) {\n  let reIPv4 = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/\n  let reIPv6 = /(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/\n\n  if (reIPv4.test(ip)) {\n    return 'IPv4'\n  } else if (reIPv6.test(ip)) {\n    return 'IPv6'\n  } else {\n    throw new Error(ip + ' is not a valid IPv4 or IPv6 address.')\n  }\n}\n","export function isFunction (arg) {\n  return typeof arg === 'function'\n}\n\nexport function isNumber (arg) {\n  return typeof arg === 'number'\n}\n\nexport function isObject (arg) {\n  return typeof arg === 'object' && arg !== null\n}\n\nexport function isUndefined (arg) {\n  return arg === void 0\n}\n","import {isFunction} from './util/is-type.js'\n\n// TODO: Strip out into own module\n\n/** Emulates Node.js event pub/sub pattern */\nexport default class EventEmitter {\n  constructor () {\n    this._eventMap = new Map()\n  }\n\n  addListener (labelString, callback) {\n    if (!isFunction(callback)) throw new TypeError('listener must be a function')\n    let labels = labelString.split(' ')\n\n    labels.forEach(label => {\n      if (!this._eventMap.has(label)) this._eventMap.set(label, [])\n      this.listeners(label).push(callback)\n    })\n\n    return this\n  }\n  on () { return this.addListener(...arguments) }\n\n  once (label, callback) {\n    if (!isFunction(callback)) throw new TypeError('listener must be a function')\n\n    var fired = false\n\n    function g () {\n      this.removeListener(label, g)\n\n      if (!fired) {\n        fired = true\n        callback.apply(this, arguments)\n      }\n    }\n\n    g.callback = callback\n    this.on(label, g)\n\n    return this\n  }\n\n  removeListener (label, callback) {\n    if (!isFunction(callback)) throw new TypeError('listener must be a function')\n\n    let currentListeners = this.listeners(label)\n    let newListeners = currentListeners.filter(listener => listener !== callback)\n\n    if (currentListeners !== newListeners) {\n      this._eventMap.set(label, newListeners)\n      return this\n    }\n  }\n  off () { return this.removeListener(...arguments) }\n\n  removeAllListeners (type) {\n    return this._eventMap.delete(type)\n  }\n\n  emit (label, ...args) {\n    let listeners = this.listeners(label)\n\n    if (listeners && listeners.length) {\n      listeners.forEach(listener => listener.apply(this, args))\n      return this\n    }\n  }\n\n  listeners (type) {\n    return this._eventMap.get(type)\n  }\n\n  static listenerCount (emitter, type) {\n    return emitter.listenerCount(type)\n  }\n}\n","import uuid from './util/uuid.js'\nimport getBrowserRTC from './util/get-browser-rtc.js'\nimport ipVersion from './util/ipvx.js'\nimport EventEmitter from './event-emitter.js'\n\nconst MAX_BUFFERED_AMOUNT = 64 * 1024\nconst CHROMIUM = typeof window !== 'undefined' && !!window.webkitRTCPeerConnection\n\n/**\n * @typedef PeerOptions\n * @type {Object}\n * @property {boolean} initiator Set to true if this local peer is the initiator\n *   of the connection.\n * @property {boolean} [allowHalfOpen=false]\n * @property {boolean} [debug=false] Set to true to log debug messages.\n */\n\n/**\n * Represents a P2P connection.\n * @extends EventEmitter\n */\nexport default class Peer extends EventEmitter {\n  /**\n   * Creates a new P2P connection and sets up internal WebRTC events.\n   * @param {PeerOptions} opts\n   */\n  constructor (opts) {\n    super()\n    this._id = uuid().substr(0, 8)\n    // self._debug('new peer %o', opts)\n\n    this.opts = Object.assign({\n      allowHalfOpen: false,\n      debug: false\n    }, opts)\n\n    this.channelName = this.opts.initiator\n      ? this.opts.channelName || uuid()\n      : null\n\n    this.initiator = this.opts.initiator || false\n    this.channelConfig = this.opts.channelConfig || Peer.channelConfig\n    this.config = this.opts.config || Peer.config\n    this.constraints = Peer.transformConstraints(this.opts.constraints || Peer.constraints)\n    this.offerConstraints = Peer.transformConstraints(this.opts.offerConstraints || {})\n    this.answerConstraints = Peer.transformConstraints(this.opts.answerConstraints || {})\n    this.reconnectTimer = this.opts.reconnectTimer || false\n    this.sdpTransform = this.opts.sdpTransform || function (sdp) { return sdp }\n    this.stream = this.opts.stream || false\n    this.trickle = this.opts.trickle !== undefined ? this.opts.trickle : true\n    this._earlyMessage = null\n\n    this.destroyed = false\n    this.connected = false\n\n    this.remoteAddress = undefined\n    this.remoteFamily = undefined\n    this.remotePort = undefined\n    this.localAddress = undefined\n    this.localPort = undefined\n\n    this._wrtc = (this.opts.wrtc && typeof this.opts.wrtc === 'object')\n      ? this.opts.wrtc\n      : getBrowserRTC()\n\n    if (!this._wrtc) {\n      throw new Error('No WebRTC support: Not a supported browser')\n    }\n\n    this._pcReady = false\n    this._channelReady = false\n    this._iceComplete = false // ice candidate trickle done (got null candidate)\n    this._channel = null\n    this._pendingCandidates = []\n    this._previousStreams = []\n\n    this._chunk = null\n    this._cb = null\n    this._interval = null\n    this._reconnectTimeout = null\n\n    this._pc = new (this._wrtc.RTCPeerConnection)(this.config, this.constraints)\n\n    this._pc.oniceconnectionstatechange = () => {\n      this._onIceStateChange()\n    }\n    this._pc.onicegatheringstatechange = () => {\n      this._onIceStateChange()\n    }\n    this._pc.onsignalingstatechange = () => {\n      this._onSignalingStateChange()\n    }\n    this._pc.onicecandidate = (event) => {\n      this._onIceCandidate(event)\n    }\n\n    // Other spec events, unused by this implementation:\n    // - onconnectionstatechange\n    // - onicecandidateerror\n    // - onfingerprintfailure\n\n    if (this.initiator) {\n      let createdOffer = false\n      this._pc.onnegotiationneeded = () => {\n        if (!createdOffer) this._createOffer()\n        createdOffer = true\n      }\n\n      this._setupData({\n        channel: this._pc.createDataChannel(this.channelName, this.channelConfig)\n      })\n    } else {\n      this._pc.ondatachannel = (event) => {\n        this._setupData(event)\n      }\n    }\n\n    if ('addTrack' in this._pc) {\n      this._pc.ontrack = (event) => {\n        this._onTrack(event)\n      }\n    } else {\n      // This can be removed once all browsers support `ontrack`\n      // Further reading: https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addStream\n      this._pc.onaddstram = (event) => {\n        this._onAddStram(event)\n      }\n    }\n    // HACK: wrtc doesn't fire the 'negotionneeded' event\n    if (this.initiator && this._isWrtc) {\n      this._pc.onnegotiationneeded()\n    }\n\n    this._onFinishBound = () => {\n      this._onFinish()\n    }\n    this.once('finish', this._onFinishBound)\n  } // END CONSTRUCTOR\n\n  /**\n   * Default WebRTC config.\n   * @constant\n   * @type {Object}\n   * @default // { iceServers: [ { urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:global.stun.twilio.com:3478?transport=udp' } ] }\n   */\n  static get config () {\n    return {\n      iceServers: [\n        {\n          urls: 'stun:stun.l.google.com:19302'\n        },\n        {\n          urls: 'stun:global.stun.twilio.com:3478?transport=udp'\n        }\n      ]\n    }\n  }\n\n  /**\n   * Flag which returns true if the current environment supports WebRTC\n   * @constant\n   * @type {boolean}\n   */\n  static get WEBRTC_SUPPORT () {\n    return !!getBrowserRTC()\n  }\n\n  /**\n   * @constant\n   * @type {Object}\n   * @default // {}\n   */\n  static get channelConfig () { return {} }\n\n  /**\n   * @constant\n   * @type {Object}\n   * @default // {}\n   */\n  static get constraints () { return {} }\n\n  /**\n   * Transform constraints objects into the new format (unless Chromium)\n   * TODO: This can be removed when Chromium supports the new format\n   */\n  static transformConstraints (constraints) {\n    if (Object.keys(constraints).length === 0) {\n      return constraints\n    }\n\n    if ((constraints.mandatory || constraints.optional) && !CHROMIUM) {\n      // convert to new format\n\n      // Merge mandatory and optional objects, prioritizing mandatory\n      var newConstraints = Object.assign({}, constraints.optional, constraints.mandatory)\n\n      // fix casing\n      if (newConstraints.OfferToReceiveVideo !== undefined) {\n        newConstraints.offerToReceiveVideo = newConstraints.OfferToReceiveVideo\n        delete newConstraints['OfferToReceiveVideo']\n      }\n\n      if (newConstraints.OfferToReceiveAudio !== undefined) {\n        newConstraints.offerToReceiveAudio = newConstraints.OfferToReceiveAudio\n        delete newConstraints['OfferToReceiveAudio']\n      }\n\n      return newConstraints\n    } else if (!constraints.mandatory && !constraints.optional && CHROMIUM) {\n      // convert to old format\n\n      // fix casing\n      if (constraints.offerToReceiveVideo !== undefined) {\n        constraints.OfferToReceiveVideo = constraints.offerToReceiveVideo\n        delete constraints['offerToReceiveVideo']\n      }\n\n      if (constraints.offerToReceiveAudio !== undefined) {\n        constraints.OfferToReceiveAudio = constraints.offerToReceiveAudio\n        delete constraints['offerToReceiveAudio']\n      }\n\n      return {\n        mandatory: constraints // NOTE: All constraints are upgraded to mandatory\n      }\n    }\n\n    return constraints\n  }\n\n  /**\n   * Getter for the `[RTCDataChannel.bufferedAmount]{@link https://developer.mozilla.org/en-US/docs/Web/API/RTCDataChannel/bufferedAmount}`\n   * property.\n   * @type {number}\n   * @default 0\n   */\n  get bufferSize () {\n    return (this._channel && this._channel.bufferedAmount) || 0\n  }\n\n  /**\n   * @typedef {Object} PeerAddress\n   * @property {number} port\n   * @property {string} family\n   * @property {string} address\n   */\n\n  /**\n   * Returns the local `PeerAddress`\n   * @type {PeerAddress}\n   */\n  get address () {\n    return {\n      port: this.localPort,\n      family: ipVersion(this.localAddress),\n      address: this.localAddress\n    }\n  }\n\n  /**\n   * `[RTCSessionDescription]{@link https://developer.mozilla.org/en-US/docs/Web/API/RTCSessionDescription}`\n   * @typedef RTCSessionDescription\n   * @type {Object}\n   */\n\n  /**\n   * The signal method attempts to setup the P2P connection using the proposed\n   * candidates.\n   * @param {RTCSessionDescription} data The signalling data\n   */\n  signal (data) {\n    if (this.destroyed) throw new Error('cannot signal after peer is destroyed')\n    if (typeof data === 'string') {\n      try {\n        data = JSON.parse(data)\n      } catch (err) {\n        data = {}\n      }\n    }\n    // self._debug('signal()')\n\n    if (data.candidate) {\n      if (this._pc.remoteDescription) this._addIceCandidate(data.candidate)\n      else this._pendingCandidates.push(data.candidate)\n    }\n    if (data.sdp) {\n      this._pc.setRemoteDescription(new (this._wrtc.RTCSessionDescription)(data), () => {\n        if (this.destroyed) return\n\n        this._pendingCandidates.forEach(candidate => this._addIceCandidate(candidate))\n        this._pendingCandidates = []\n\n        if (this._pc.remoteDescription.type === 'offer') this._createAnswer()\n      }, (err) => { this._destroy(err) })\n    }\n    if (!data.sdp && !data.candidate) {\n      this._destroy(new Error('signal() called with invalid signal data'))\n    }\n  }\n\n  /**\n  * Send text/binary data to the remote peer.\n  * @param {TypedArrayView|ArrayBuffer|Buffer|string|Blob|Object} chunk\n  */\n  send (chunk) {\n    this._channel.send(chunk)\n  }\n\n  /**\n   * Destroys the connections and socket.\n   * @param {function} onclose On close callback\n   */\n  destroy (onclose) {\n    this._destroy(null, onclose)\n  }\n\n  /**\n   * @callback getStatsCallback\n   * @param {?Error} err\n   * @param {Array} reports\n   */\n\n  /**\n   * Wraps the promise based `RTCRtpSender.getStats()` method in a callback\n   * based approach.\n   * @param {getStatsCallback} cb Callback that handles the response\n   */\n  getStats (cb) {\n    // Promise-based getStats() (standard)\n    if (this._pc.getStats.length === 0) {\n      this._pc.getStats().then(function (res) {\n        var reports = []\n        res.forEach(function (report) {\n          reports.push(report)\n        })\n        cb(null, reports)\n      }, function (err) { cb(err) })\n\n      // Single-parameter callback-based getStats() (non-standard)\n    } else if (this._pc.getStats.length > 0) {\n      this._pc.getStats(function (res) {\n        // If we destroy connection in `connect` callback this code might happen to run when actual connection is already closed\n        if (this.destroyed) return\n\n        var reports = []\n        res.result().forEach(function (result) {\n          var report = {}\n          result.names().forEach(function (name) {\n            report[name] = result.stat(name)\n          })\n          report.id = result.id\n          report.type = result.type\n          report.timestamp = result.timestamp\n          reports.push(report)\n        })\n        cb(null, reports)\n      }, function (err) { cb(err) })\n\n      // Unknown browser, skip getStats() since it's anyone's guess which style of\n      // getStats() they implement.\n    } else {\n      cb(null, [])\n    }\n  }\n\n  // ***** PRIVATE METHODS ***** //\n\n  /**\n   * @private\n   * A wrapper for the `[RTCPeerConnection.addIceCandidate()]{@link https://developer.mozilla.org/en-US/docs/Web/API/RTCIceCandidate}`\n   * method.\n   * @param {Object} candidate An object conforming to the RTCIceCandidateInit\n   *  dictionary.\n   */\n  _addIceCandidate (candidate) {\n    try {\n      this._pc.addIceCandidate(\n        new this._wrtc.RTCIceCandidate(candidate),\n        noop,\n        function (err) { this._destroy(err) }\n      )\n    } catch (err) {\n      this._destroy(new Error('error adding candidate: ' + err.message))\n    }\n  }\n\n  /**\n   * @private\n   * Method which destroys the socket and connection when an error occurs.\n   * Can be called using the public method `Peer.destroy()`. Catch these errors\n   * by creating a `Peer.on('error', handler)` event handler.\n   * @param {?Error} err The error that occured.\n   * @param {function} onclose On close callback\n   */\n  _destroy (err, onclose) {\n    if (this.destroyed) return\n    if (onclose) this.once('close', onclose)\n\n    // this._debug('destroy (error: %s)', err && (err.message || err))\n\n    // this.readable = this.writable = false\n    //\n    // if (!self._readableState.ended) self.push(null)\n    // if (!self._writableState.finished) self.end()\n\n    this.destroyed = true\n    this.connected = false\n    this._pcReady = false\n    this._channelReady = false\n    this._previousStreams = null\n    this._earlyMessage = null\n\n    clearInterval(this._interval)\n    clearTimeout(this._reconnectTimeout)\n    this._interval = null\n    this._reconnectTimeout = null\n    this._chunk = null\n    this._cb = null\n\n    if (this._onFinishBound) this.off('finish', this._onFinishBound)\n    this._onFinishBound = null\n\n    if (this._pc) {\n      try {\n        this._pc.close()\n      } catch (err) {}\n\n      this._pc.oniceconnectionstatechange = null\n      this._pc.onicegatheringstatechange = null\n      this._pc.onsignalingstatechange = null\n      this._pc.onicecandidate = null\n      if ('addTrack' in this._pc) {\n        this._pc.ontrack = null\n      } else {\n        this._pc.onaddstream = null\n      }\n      this._pc.onnegotiationneeded = null\n      this._pc.ondatachannel = null\n    }\n\n    if (this._channel) {\n      try {\n        this._channel.close()\n      } catch (err) {}\n\n      this._channel.onmessage = null\n      this._channel.onopen = null\n      this._channel.onclose = null\n      this._channel.onerror = null\n    }\n    this._pc = null\n    this._channel = null\n\n    if (err) this.emit('error', err)\n    this.emit('close')\n  }\n\n  /**\n   * @private\n   * Setup a new Data Channel along with the appropriate callbacks\n   * @param {Object} event A `[datachannel]{@link https://developer.mozilla.org/en-US/docs/Web/Events/datachannel}`\n   *   event with at least a `channel` property.\n   */\n  _setupData (event) {\n    if (!event.channel) {\n      // In some situations `pc.createDataChannel()` returns `undefined` (in wrtc),\n      // which is invalid behavior. Handle it gracefully.\n      // See: https://github.com/feross/simple-peer/issues/163\n      return this._destroy(new Error('Data channel event is missing `channel` property'))\n    }\n\n    this._channel = event.channel\n    this._channel.binaryType = 'arraybuffer'\n\n    if (typeof this._channel.bufferedAmountLowThreshold === 'number') {\n      this._channel.bufferedAmountLowThreshold = MAX_BUFFERED_AMOUNT\n    }\n\n    this.channelName = this._channel.label\n\n    this._channel.onmessage = (event) => {\n      if (!this._channelReady) { // HACK: Workaround for Chrome not firing \"open\" between tabs\n        this._earlyMessage = event\n        this._onChannelOpen()\n      } else {\n        this._onChannelMessage(event)\n      }\n    }\n    this._channel.onbufferedamountlow = () => {\n      this._onChannelBufferedAmountLow()\n    }\n    this._channel.onopen = () => {\n      if (!this._channelReady) this._onChannelOpen()\n    }\n    this._channel.onclose = () => {\n      this._onChannelClose()\n    }\n    this._channel.onerror = (err) => {\n      this._destroy(err)\n    }\n  }\n\n  // FIXME: This is legacy code from simple-peer. Is it needed?\n  _write (chunk, encoding, cb) {\n    if (this.destroyed) return cb(new Error('cannot write after peer is destroyed'))\n\n    if (this.connected) {\n      try {\n        this.send(chunk)\n      } catch (err) {\n        return this._destroy(err)\n      }\n      if (this._channel.bufferedAmount > MAX_BUFFERED_AMOUNT) {\n        // this._debug('start backpressure: bufferedAmount %d', this._channel.bufferedAmount)\n        this._cb = cb\n      } else {\n        cb(null)\n      }\n    } else {\n      // this._debug('write before connect')\n      this._chunk = chunk\n      this._cb = cb\n    }\n  }\n\n  _createOffer () {\n    if (this.destroyed) return\n\n    this._pc.createOffer((offer) => {\n      var onSuccess = () => {\n        if (this.destroyed) return\n        if (this.trickle || this._iceComplete) sendOffer()\n        else this.once('_iceComplete', sendOffer) // wait for candidates\n      }\n\n      var sendOffer = () => {\n        var signal = this._pc.localDescription || offer\n        // this._debug('signal')\n        this.emit('signal', {\n          type: signal.type,\n          sdp: signal.sdp\n        })\n      }\n\n      var onError = (err) => {\n        this._destroy(err)\n      }\n\n      if (this.destroyed) return\n      offer.sdp = this.sdpTransform(offer.sdp)\n      this._pc.setLocalDescription(offer, onSuccess, onError)\n    }, function (err) { this._destroy(err) }, this.offerConstraints)\n  }\n\n  _createAnswer () {\n    if (this.destroyed) return\n\n    this._pc.createAnswer((answer) => {\n      var onSuccess = () => {\n        if (this.destroyed) return\n        if (this.trickle || this._iceComplete) sendAnswer()\n        else this.once('_iceComplete', sendAnswer)\n      }\n\n      var sendAnswer = () => {\n        var signal = this._pc.localDescription || answer\n        // this._debug('signal')\n        this.emit('signal', {\n          type: signal.type,\n          sdp: signal.sdp\n        })\n      }\n\n      var onError = (err) => {\n        this._destroy(err)\n      }\n\n      if (this.destroyed) return\n      answer.sdp = this.sdpTransform(answer.sdp)\n      this._pc.setLocalDescription(answer, onSuccess, onError)\n    }, function (err) { this._destroy(err) }, this.answerConstraints)\n  }\n\n  _onIceStateChange () {\n    if (this.destroyed) return\n    var iceConnectionState = this._pc.iceConnectionState\n    var iceGatheringState = this._pc.iceGatheringState\n\n    // this._debug(\n    //   'iceStateChange (connection: %s) (gathering: %s)',\n    //   iceConnectionState,\n    //   iceGatheringState\n    // )\n    this.emit('iceStateChange', iceConnectionState, iceGatheringState)\n\n    if (iceConnectionState === 'connected' || iceConnectionState === 'completed') {\n      clearTimeout(this._reconnectTimeout)\n      this._pcReady = true\n      this._maybeReady()\n    }\n    if (iceConnectionState === 'disconnected') {\n      if (this.reconnectTimer) {\n        // If user has set `opt.reconnectTimer`, allow time for ICE to attempt a reconnect\n        clearTimeout(this._reconnectTimeout)\n        this._reconnectTimeout = setTimeout(function () {\n          this._destroy()\n        }, this.reconnectTimer)\n      } else {\n        this._destroy()\n      }\n    }\n    if (iceConnectionState === 'failed') {\n      this._destroy(new Error('Ice connection failed.'))\n    }\n    if (iceConnectionState === 'closed') {\n      this._destroy()\n    }\n  }\n\n  _maybeReady () {\n    // this._debug('maybeReady pc %s channel %s', this._pcReady, this._channelReady)\n    if (this.connected || this._connecting || !this._pcReady || !this._channelReady) return\n\n    this._connecting = true\n\n    // HACK: We can't rely on order here, for details see https://github.com/js-platform/node-webrtc/issues/339\n    var findCandidatePair = () => {\n      if (this.destroyed) return\n\n      this.getStats((err, items) => {\n        if (this.destroyed) return\n\n        // Treat getStats error as non-fatal. It's not essential.\n        if (err) items = []\n\n        var remoteCandidates = {}\n        var localCandidates = {}\n        var candidatePairs = {}\n        var foundSelectedCandidatePair = false\n\n        var setSelectedCandidatePair = (selectedCandidatePair) => {\n          foundSelectedCandidatePair = true\n\n          var local = localCandidates[selectedCandidatePair.localCandidateId]\n\n          if (local && local.ip) {\n            // Spec\n            this.localAddress = local.ip\n            this.localPort = Number(local.port)\n          } else if (local && local.ipAddress) {\n            // Firefox\n            this.localAddress = local.ipAddress\n            this.localPort = Number(local.portNumber)\n          } else if (typeof selectedCandidatePair.googLocalAddress === 'string') {\n            // TODO: remove this once Chrome 58 is released\n            local = selectedCandidatePair.googLocalAddress.split(':')\n            this.localAddress = local[0]\n            this.localPort = Number(local[1])\n          }\n\n          var remote = remoteCandidates[selectedCandidatePair.remoteCandidateId]\n\n          if (remote && remote.ip) {\n            // Spec\n            this.remoteAddress = remote.ip\n            this.remotePort = Number(remote.port)\n          } else if (remote && remote.ipAddress) {\n            // Firefox\n            this.remoteAddress = remote.ipAddress\n            this.remotePort = Number(remote.portNumber)\n          } else if (typeof selectedCandidatePair.googRemoteAddress === 'string') {\n            // TODO: remove this once Chrome 58 is released\n            remote = selectedCandidatePair.googRemoteAddress.split(':')\n            this.remoteAddress = remote[0]\n            this.remotePort = Number(remote[1])\n          }\n          this.remoteFamily = 'IPv4'\n\n          // this._debug(\n          //   'connect local: %s:%s remote: %s:%s',\n          //   this.localAddress, this.localPort, this.remoteAddress, this.remotePort\n          // )\n        }\n\n        items.forEach(function (item) {\n          // TODO: Once all browsers support the hyphenated stats report types, remove the non-hypenated ones\n          if (item.type === 'remotecandidate' || item.type === 'remote-candidate') {\n            remoteCandidates[item.id] = item\n          }\n          if (item.type === 'localcandidate' || item.type === 'local-candidate') {\n            localCandidates[item.id] = item\n          }\n          if (item.type === 'candidatepair' || item.type === 'candidate-pair') {\n            candidatePairs[item.id] = item\n          }\n        })\n\n        items.forEach(function (item) {\n          // Spec-compliant\n          if (item.type === 'transport') {\n            setSelectedCandidatePair(candidatePairs[item.selectedCandidatePairId])\n          }\n\n          // Old implementations\n          if (\n            (item.type === 'googCandidatePair' && item.googActiveConnection === 'true') ||\n            ((item.type === 'candidatepair' || item.type === 'candidate-pair') && item.selected)\n          ) {\n            setSelectedCandidatePair(item)\n          }\n        })\n\n        if (!foundSelectedCandidatePair && items.length) {\n          setTimeout(findCandidatePair, 100)\n          return\n        } else {\n          this._connecting = false\n          this.connected = true\n        }\n\n        if (this._chunk) {\n          try {\n            this.send(this._chunk)\n          } catch (err) {\n            return this._destroy(err)\n          }\n          this._chunk = null\n          // this._debug('sent chunk from \"write before connect\"')\n\n          var cb = this._cb\n          this._cb = null\n          cb(null)\n        }\n\n        // If `bufferedAmountLowThreshold` and 'onbufferedamountlow' are unsupported,\n        // fallback to using setInterval to implement backpressure.\n        if (typeof this._channel.bufferedAmountLowThreshold !== 'number') {\n          this._interval = setInterval(this._onInterval, 150)\n          if (this._interval.unref) this._interval.unref()\n        }\n\n        // this._debug('connect')\n        this.emit('connect')\n        if (this._earlyMessage) { // HACK: Workaround for Chrome not firing \"open\" between tabs\n          this._onChannelMessage(this._earlyMessage)\n          this._earlyMessage = null\n        }\n      })\n    }\n    findCandidatePair()\n  }\n\n  // ***** CALLBACKS ***** //\n\n  _onFinish () {\n    if (this.destroyed) return\n\n    if (this.connected) {\n      destroySoon()\n    } else {\n      this.once('connect', destroySoon)\n    }\n\n    // Wait a bit before destroying so the socket flushes.\n    // TODO: is there a more reliable way to accomplish this?\n    function destroySoon () {\n      setTimeout(function () {\n        this._destroy()\n      }, 1000)\n    }\n  }\n\n  _onInterval () {\n    if (!this._cb || !this._channel || this._channel.bufferedAmount > MAX_BUFFERED_AMOUNT) {\n      return\n    }\n    this._onChannelBufferedAmountLow()\n  }\n\n  _onSignalingStateChange () {\n    if (this.destroyed) return\n    // this._debug('signalingStateChange %s', this._pc.signalingState)\n    this.emit('signalingStateChange', this._pc.signalingState)\n  }\n\n  _onIceCandidate (event) {\n    if (this.destroyed) return\n    if (event.candidate && this.trickle) {\n      this.emit('signal', {\n        candidate: {\n          candidate: event.candidate.candidate,\n          sdpMLineIndex: event.candidate.sdpMLineIndex,\n          sdpMid: event.candidate.sdpMid\n        }\n      })\n    } else if (!event.candidate) {\n      this._iceComplete = true\n      this.emit('_iceComplete')\n    }\n  }\n\n  _onChannelMessage (event) {\n    if (this.destroyed) return\n    var data = event.data\n    if (data instanceof ArrayBuffer) data = Buffer.from(data)\n    this.emit('data', data)\n  }\n\n  _onChannelBufferedAmountLow () {\n    if (this.destroyed || !this._cb) return\n    // this._debug('ending backpressure: bufferedAmount %d', this._channel.bufferedAmount)\n    var cb = this._cb\n    this._cb = null\n    cb(null)\n  }\n\n  _onChannelOpen () {\n    var self = this\n    if (self.connected || self.destroyed) return\n    // self._debug('on channel open')\n    self._channelReady = true\n    self._maybeReady()\n  }\n\n  _onChannelClose () {\n    if (this.destroyed) return\n    // this._debug('on channel close')\n    this._destroy()\n  }\n\n  _onTrack (event) {\n    if (this.destroyed) return\n    this._debug('on track')\n    var id = event.streams[0].id\n    if (this._previousStreams.indexOf(id) !== -1) return // Only fire one 'stream' event, even though there may be multiple tracks per stream\n    this._previousStreams.push(id)\n    this.emit('stream', event.streams[0])\n  }\n\n  _debug (msg) { if (this.opts.debug) console.debug(msg) }\n}\n\nfunction noop () {}\n"],"names":[],"mappings":";;AAAe,SAAS,IAAI,IAAI;EAC9B,IAAI,IAAI,GAAG,GAAE;EACb,IAAI,EAAC;EACL,IAAI,OAAM;EACV,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;IACvB,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,GAAG,EAAC;;IAE/B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE;MAC/C,IAAI,IAAI,IAAG;KACZ;IACD,IAAI,IAAI,CAAC,CAAC,KAAK,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,MAAM,GAAG,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,EAAE,QAAQ,CAAC,EAAE,EAAC;GAC7E;EACD,OAAO,IAAI;CACZ;;ACbD;;AAEA,AAAe,SAAS,aAAa,IAAI;EACvC,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE,OAAO,IAAI;EAC9C,IAAI,IAAI,GAAG;IACT,iBAAiB,EAAE,MAAM,CAAC,iBAAiB,IAAI,MAAM,CAAC,oBAAoB;MACxE,MAAM,CAAC,uBAAuB;IAChC,qBAAqB,EAAE,MAAM,CAAC,qBAAqB;MACjD,MAAM,CAAC,wBAAwB,IAAI,MAAM,CAAC,2BAA2B;IACvE,eAAe,EAAE,MAAM,CAAC,eAAe,IAAI,MAAM,CAAC,kBAAkB;MAClE,MAAM,CAAC,qBAAqB;IAC/B;EACD,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,OAAO,IAAI;EACxC,OAAO,IAAI;CACZ;;ACdD;;;;;;;;AAQA,AAAe,SAAS,SAAS,EAAE,EAAE,EAAE;EACrC,IAAI,MAAM,GAAG,mKAAkK;EAC/K,IAAI,MAAM,GAAG,spBAAqpB;;EAElqB,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE;IACnB,OAAO,MAAM;GACd,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE;IAC1B,OAAO,MAAM;GACd,MAAM;IACL,MAAM,IAAI,KAAK,CAAC,EAAE,GAAG,uCAAuC,CAAC;GAC9D;CACF;;ACnBM,SAAS,UAAU,EAAE,GAAG,EAAE;EAC/B,OAAO,OAAO,GAAG,KAAK,UAAU;CACjC;;ACAD;;;AAGA,AAAe,MAAM,YAAY,CAAC;EAChC,WAAW,CAAC,GAAG;IACb,IAAI,CAAC,SAAS,GAAG,IAAI,GAAG,GAAE;GAC3B;;EAED,WAAW,CAAC,CAAC,WAAW,EAAE,QAAQ,EAAE;IAClC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,MAAM,IAAI,SAAS,CAAC,6BAA6B,CAAC;IAC7E,IAAI,MAAM,GAAG,WAAW,CAAC,KAAK,CAAC,GAAG,EAAC;;IAEnC,MAAM,CAAC,OAAO,CAAC,KAAK,IAAI;MACtB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,EAAC;MAC7D,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAC;KACrC,EAAC;;IAEF,OAAO,IAAI;GACZ;EACD,EAAE,CAAC,GAAG,EAAE,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,SAAS,CAAC,EAAE;;EAE/C,IAAI,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE;IACrB,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,MAAM,IAAI,SAAS,CAAC,6BAA6B,CAAC;;IAE7E,IAAI,KAAK,GAAG,MAAK;;IAEjB,SAAS,CAAC,IAAI;MACZ,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,EAAC;;MAE7B,IAAI,CAAC,KAAK,EAAE;QACV,KAAK,GAAG,KAAI;QACZ,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,EAAC;OAChC;KACF;;IAED,CAAC,CAAC,QAAQ,GAAG,SAAQ;IACrB,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC,EAAC;;IAEjB,OAAO,IAAI;GACZ;;EAED,cAAc,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE;IAC/B,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,MAAM,IAAI,SAAS,CAAC,6BAA6B,CAAC;;IAE7E,IAAI,gBAAgB,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAC;IAC5C,IAAI,YAAY,GAAG,gBAAgB,CAAC,MAAM,CAAC,QAAQ,IAAI,QAAQ,KAAK,QAAQ,EAAC;;IAE7E,IAAI,gBAAgB,KAAK,YAAY,EAAE;MACrC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,EAAE,YAAY,EAAC;MACvC,OAAO,IAAI;KACZ;GACF;EACD,GAAG,CAAC,GAAG,EAAE,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,SAAS,CAAC,EAAE;;EAEnD,kBAAkB,CAAC,CAAC,IAAI,EAAE;IACxB,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC;GACnC;;EAED,IAAI,CAAC,CAAC,KAAK,EAAE,GAAG,IAAI,EAAE;IACpB,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAC;;IAErC,IAAI,SAAS,IAAI,SAAS,CAAC,MAAM,EAAE;MACjC,SAAS,CAAC,OAAO,CAAC,QAAQ,IAAI,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,EAAC;MACzD,OAAO,IAAI;KACZ;GACF;;EAED,SAAS,CAAC,CAAC,IAAI,EAAE;IACf,OAAO,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC;GAChC;;EAED,OAAO,aAAa,CAAC,CAAC,OAAO,EAAE,IAAI,EAAE;IACnC,OAAO,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC;GACnC;CACF;;ACvED,MAAM,mBAAmB,GAAG,EAAE,GAAG,KAAI;AACrC,MAAM,QAAQ,GAAG,OAAO,MAAM,KAAK,WAAW,IAAI,CAAC,CAAC,MAAM,CAAC,wBAAuB;;;;;;;;;;;;;;;AAelF,AAAe,MAAM,IAAI,SAAS,YAAY,CAAC;;;;;EAK7C,WAAW,CAAC,CAAC,IAAI,EAAE;IACjB,KAAK,GAAE;IACP,IAAI,CAAC,GAAG,GAAG,IAAI,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAC;;;IAG9B,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC;MACxB,aAAa,EAAE,KAAK;MACpB,KAAK,EAAE,KAAK;KACb,EAAE,IAAI,EAAC;;IAER,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS;QAClC,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,EAAE;QAC/B,KAAI;;IAER,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,MAAK;IAC7C,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,cAAa;IAClE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,OAAM;IAC7C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,EAAC;IACvF,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,IAAI,EAAE,EAAC;IACnF,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,IAAI,EAAE,EAAC;IACrF,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,MAAK;IACvD,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,UAAU,GAAG,EAAE,EAAE,OAAO,GAAG,GAAE;IAC3E,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,MAAK;IACvC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,KAAK,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,KAAI;IACzE,IAAI,CAAC,aAAa,GAAG,KAAI;;IAEzB,IAAI,CAAC,SAAS,GAAG,MAAK;IACtB,IAAI,CAAC,SAAS,GAAG,MAAK;;IAEtB,IAAI,CAAC,aAAa,GAAG,UAAS;IAC9B,IAAI,CAAC,YAAY,GAAG,UAAS;IAC7B,IAAI,CAAC,UAAU,GAAG,UAAS;IAC3B,IAAI,CAAC,YAAY,GAAG,UAAS;IAC7B,IAAI,CAAC,SAAS,GAAG,UAAS;;IAE1B,IAAI,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,KAAK,QAAQ;QAC9D,IAAI,CAAC,IAAI,CAAC,IAAI;QACd,aAAa,GAAE;;IAEnB,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;MACf,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC;KAC9D;;IAED,IAAI,CAAC,QAAQ,GAAG,MAAK;IACrB,IAAI,CAAC,aAAa,GAAG,MAAK;IAC1B,IAAI,CAAC,YAAY,GAAG,MAAK;IACzB,IAAI,CAAC,QAAQ,GAAG,KAAI;IACpB,IAAI,CAAC,kBAAkB,GAAG,GAAE;IAC5B,IAAI,CAAC,gBAAgB,GAAG,GAAE;;IAE1B,IAAI,CAAC,MAAM,GAAG,KAAI;IAClB,IAAI,CAAC,GAAG,GAAG,KAAI;IACf,IAAI,CAAC,SAAS,GAAG,KAAI;IACrB,IAAI,CAAC,iBAAiB,GAAG,KAAI;;IAE7B,IAAI,CAAC,GAAG,GAAG,KAAK,IAAI,CAAC,KAAK,CAAC,iBAAiB,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,EAAC;;IAE5E,IAAI,CAAC,GAAG,CAAC,0BAA0B,GAAG,MAAM;MAC1C,IAAI,CAAC,iBAAiB,GAAE;MACzB;IACD,IAAI,CAAC,GAAG,CAAC,yBAAyB,GAAG,MAAM;MACzC,IAAI,CAAC,iBAAiB,GAAE;MACzB;IACD,IAAI,CAAC,GAAG,CAAC,sBAAsB,GAAG,MAAM;MACtC,IAAI,CAAC,uBAAuB,GAAE;MAC/B;IACD,IAAI,CAAC,GAAG,CAAC,cAAc,GAAG,CAAC,KAAK,KAAK;MACnC,IAAI,CAAC,eAAe,CAAC,KAAK,EAAC;MAC5B;;;;;;;IAOD,IAAI,IAAI,CAAC,SAAS,EAAE;MAClB,IAAI,YAAY,GAAG,MAAK;MACxB,IAAI,CAAC,GAAG,CAAC,mBAAmB,GAAG,MAAM;QACnC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,YAAY,GAAE;QACtC,YAAY,GAAG,KAAI;QACpB;;MAED,IAAI,CAAC,UAAU,CAAC;QACd,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,CAAC;OAC1E,EAAC;KACH,MAAM;MACL,IAAI,CAAC,GAAG,CAAC,aAAa,GAAG,CAAC,KAAK,KAAK;QAClC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAC;QACvB;KACF;;IAED,IAAI,UAAU,IAAI,IAAI,CAAC,GAAG,EAAE;MAC1B,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,KAAK,KAAK;QAC5B,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAC;QACrB;KACF,MAAM;;;MAGL,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,CAAC,KAAK,KAAK;QAC/B,IAAI,CAAC,WAAW,CAAC,KAAK,EAAC;QACxB;KACF;;IAED,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,OAAO,EAAE;MAClC,IAAI,CAAC,GAAG,CAAC,mBAAmB,GAAE;KAC/B;;IAED,IAAI,CAAC,cAAc,GAAG,MAAM;MAC1B,IAAI,CAAC,SAAS,GAAE;MACjB;IACD,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,cAAc,EAAC;GACzC;;;;;;;;EAQD,WAAW,MAAM,CAAC,GAAG;IACnB,OAAO;MACL,UAAU,EAAE;QACV;UACE,IAAI,EAAE,8BAA8B;SACrC;QACD;UACE,IAAI,EAAE,gDAAgD;SACvD;OACF;KACF;GACF;;;;;;;EAOD,WAAW,cAAc,CAAC,GAAG;IAC3B,OAAO,CAAC,CAAC,aAAa,EAAE;GACzB;;;;;;;EAOD,WAAW,aAAa,CAAC,GAAG,EAAE,OAAO,EAAE,EAAE;;;;;;;EAOzC,WAAW,WAAW,CAAC,GAAG,EAAE,OAAO,EAAE,EAAE;;;;;;EAMvC,OAAO,oBAAoB,CAAC,CAAC,WAAW,EAAE;IACxC,IAAI,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;MACzC,OAAO,WAAW;KACnB;;IAED,IAAI,CAAC,WAAW,CAAC,SAAS,IAAI,WAAW,CAAC,QAAQ,KAAK,CAAC,QAAQ,EAAE;;;;MAIhE,IAAI,cAAc,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,WAAW,CAAC,QAAQ,EAAE,WAAW,CAAC,SAAS,EAAC;;;MAGnF,IAAI,cAAc,CAAC,mBAAmB,KAAK,SAAS,EAAE;QACpD,cAAc,CAAC,mBAAmB,GAAG,cAAc,CAAC,oBAAmB;QACvE,OAAO,cAAc,CAAC,qBAAqB,EAAC;OAC7C;;MAED,IAAI,cAAc,CAAC,mBAAmB,KAAK,SAAS,EAAE;QACpD,cAAc,CAAC,mBAAmB,GAAG,cAAc,CAAC,oBAAmB;QACvE,OAAO,cAAc,CAAC,qBAAqB,EAAC;OAC7C;;MAED,OAAO,cAAc;KACtB,MAAM,IAAI,CAAC,WAAW,CAAC,SAAS,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,QAAQ,EAAE;;;;MAItE,IAAI,WAAW,CAAC,mBAAmB,KAAK,SAAS,EAAE;QACjD,WAAW,CAAC,mBAAmB,GAAG,WAAW,CAAC,oBAAmB;QACjE,OAAO,WAAW,CAAC,qBAAqB,EAAC;OAC1C;;MAED,IAAI,WAAW,CAAC,mBAAmB,KAAK,SAAS,EAAE;QACjD,WAAW,CAAC,mBAAmB,GAAG,WAAW,CAAC,oBAAmB;QACjE,OAAO,WAAW,CAAC,qBAAqB,EAAC;OAC1C;;MAED,OAAO;QACL,SAAS,EAAE,WAAW;OACvB;KACF;;IAED,OAAO,WAAW;GACnB;;;;;;;;EAQD,IAAI,UAAU,CAAC,GAAG;IAChB,OAAO,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,KAAK,CAAC;GAC5D;;;;;;;;;;;;;EAaD,IAAI,OAAO,CAAC,GAAG;IACb,OAAO;MACL,IAAI,EAAE,IAAI,CAAC,SAAS;MACpB,MAAM,EAAE,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC;MACpC,OAAO,EAAE,IAAI,CAAC,YAAY;KAC3B;GACF;;;;;;;;;;;;;EAaD,MAAM,CAAC,CAAC,IAAI,EAAE;IACZ,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC;IAC5E,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;MAC5B,IAAI;QACF,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,EAAC;OACxB,CAAC,OAAO,GAAG,EAAE;QACZ,IAAI,GAAG,GAAE;OACV;KACF;;;IAGD,IAAI,IAAI,CAAC,SAAS,EAAE;MAClB,IAAI,IAAI,CAAC,GAAG,CAAC,iBAAiB,EAAE,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS,EAAC;WAChE,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAC;KAClD;IACD,IAAI,IAAI,CAAC,GAAG,EAAE;MACZ,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,qBAAqB,EAAE,IAAI,CAAC,EAAE,MAAM;QAChF,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;QAE1B,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,SAAS,IAAI,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,EAAC;QAC9E,IAAI,CAAC,kBAAkB,GAAG,GAAE;;QAE5B,IAAI,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,KAAK,OAAO,EAAE,IAAI,CAAC,aAAa,GAAE;OACtE,EAAE,CAAC,GAAG,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAC,EAAE,EAAC;KACpC;IACD,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;MAChC,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,0CAA0C,CAAC,EAAC;KACrE;GACF;;;;;;EAMD,IAAI,CAAC,CAAC,KAAK,EAAE;IACX,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAC;GAC1B;;;;;;EAMD,OAAO,CAAC,CAAC,OAAO,EAAE;IAChB,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAO,EAAC;GAC7B;;;;;;;;;;;;;EAaD,QAAQ,CAAC,CAAC,EAAE,EAAE;;IAEZ,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;MAClC,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;QACtC,IAAI,OAAO,GAAG,GAAE;QAChB,GAAG,CAAC,OAAO,CAAC,UAAU,MAAM,EAAE;UAC5B,OAAO,CAAC,IAAI,CAAC,MAAM,EAAC;SACrB,EAAC;QACF,EAAE,CAAC,IAAI,EAAE,OAAO,EAAC;OAClB,EAAE,UAAU,GAAG,EAAE,EAAE,EAAE,CAAC,GAAG,EAAC,EAAE,EAAC;;;KAG/B,MAAM,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;MACvC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,GAAG,EAAE;;QAE/B,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;QAE1B,IAAI,OAAO,GAAG,GAAE;QAChB,GAAG,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,UAAU,MAAM,EAAE;UACrC,IAAI,MAAM,GAAG,GAAE;UACf,MAAM,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE;YACrC,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,EAAC;WACjC,EAAC;UACF,MAAM,CAAC,EAAE,GAAG,MAAM,CAAC,GAAE;UACrB,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,KAAI;UACzB,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,UAAS;UACnC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAC;SACrB,EAAC;QACF,EAAE,CAAC,IAAI,EAAE,OAAO,EAAC;OAClB,EAAE,UAAU,GAAG,EAAE,EAAE,EAAE,CAAC,GAAG,EAAC,EAAE,EAAC;;;;KAI/B,MAAM;MACL,EAAE,CAAC,IAAI,EAAE,EAAE,EAAC;KACb;GACF;;;;;;;;;;;EAWD,gBAAgB,CAAC,CAAC,SAAS,EAAE;IAC3B,IAAI;MACF,IAAI,CAAC,GAAG,CAAC,eAAe;QACtB,IAAI,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,SAAS,CAAC;QACzC,IAAI;QACJ,UAAU,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAC,EAAE;QACtC;KACF,CAAC,OAAO,GAAG,EAAE;MACZ,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,0BAA0B,GAAG,GAAG,CAAC,OAAO,CAAC,EAAC;KACnE;GACF;;;;;;;;;;EAUD,QAAQ,CAAC,CAAC,GAAG,EAAE,OAAO,EAAE;IACtB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;IAC1B,IAAI,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,EAAC;;;;;;;;;IASxC,IAAI,CAAC,SAAS,GAAG,KAAI;IACrB,IAAI,CAAC,SAAS,GAAG,MAAK;IACtB,IAAI,CAAC,QAAQ,GAAG,MAAK;IACrB,IAAI,CAAC,aAAa,GAAG,MAAK;IAC1B,IAAI,CAAC,gBAAgB,GAAG,KAAI;IAC5B,IAAI,CAAC,aAAa,GAAG,KAAI;;IAEzB,aAAa,CAAC,IAAI,CAAC,SAAS,EAAC;IAC7B,YAAY,CAAC,IAAI,CAAC,iBAAiB,EAAC;IACpC,IAAI,CAAC,SAAS,GAAG,KAAI;IACrB,IAAI,CAAC,iBAAiB,GAAG,KAAI;IAC7B,IAAI,CAAC,MAAM,GAAG,KAAI;IAClB,IAAI,CAAC,GAAG,GAAG,KAAI;;IAEf,IAAI,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,cAAc,EAAC;IAChE,IAAI,CAAC,cAAc,GAAG,KAAI;;IAE1B,IAAI,IAAI,CAAC,GAAG,EAAE;MACZ,IAAI;QACF,IAAI,CAAC,GAAG,CAAC,KAAK,GAAE;OACjB,CAAC,OAAO,GAAG,EAAE,EAAE;;MAEhB,IAAI,CAAC,GAAG,CAAC,0BAA0B,GAAG,KAAI;MAC1C,IAAI,CAAC,GAAG,CAAC,yBAAyB,GAAG,KAAI;MACzC,IAAI,CAAC,GAAG,CAAC,sBAAsB,GAAG,KAAI;MACtC,IAAI,CAAC,GAAG,CAAC,cAAc,GAAG,KAAI;MAC9B,IAAI,UAAU,IAAI,IAAI,CAAC,GAAG,EAAE;QAC1B,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,KAAI;OACxB,MAAM;QACL,IAAI,CAAC,GAAG,CAAC,WAAW,GAAG,KAAI;OAC5B;MACD,IAAI,CAAC,GAAG,CAAC,mBAAmB,GAAG,KAAI;MACnC,IAAI,CAAC,GAAG,CAAC,aAAa,GAAG,KAAI;KAC9B;;IAED,IAAI,IAAI,CAAC,QAAQ,EAAE;MACjB,IAAI;QACF,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAE;OACtB,CAAC,OAAO,GAAG,EAAE,EAAE;;MAEhB,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,KAAI;MAC9B,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,KAAI;MAC3B,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAI;MAC5B,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAI;KAC7B;IACD,IAAI,CAAC,GAAG,GAAG,KAAI;IACf,IAAI,CAAC,QAAQ,GAAG,KAAI;;IAEpB,IAAI,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,EAAC;IAChC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAC;GACnB;;;;;;;;EAQD,UAAU,CAAC,CAAC,KAAK,EAAE;IACjB,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE;;;;MAIlB,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;KACpF;;IAED,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAO;IAC7B,IAAI,CAAC,QAAQ,CAAC,UAAU,GAAG,cAAa;;IAExC,IAAI,OAAO,IAAI,CAAC,QAAQ,CAAC,0BAA0B,KAAK,QAAQ,EAAE;MAChE,IAAI,CAAC,QAAQ,CAAC,0BAA0B,GAAG,oBAAmB;KAC/D;;IAED,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAK;;IAEtC,IAAI,CAAC,QAAQ,CAAC,SAAS,GAAG,CAAC,KAAK,KAAK;MACnC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;QACvB,IAAI,CAAC,aAAa,GAAG,MAAK;QAC1B,IAAI,CAAC,cAAc,GAAE;OACtB,MAAM;QACL,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAC;OAC9B;MACF;IACD,IAAI,CAAC,QAAQ,CAAC,mBAAmB,GAAG,MAAM;MACxC,IAAI,CAAC,2BAA2B,GAAE;MACnC;IACD,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,MAAM;MAC3B,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,cAAc,GAAE;MAC/C;IACD,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,MAAM;MAC5B,IAAI,CAAC,eAAe,GAAE;MACvB;IACD,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,CAAC,GAAG,KAAK;MAC/B,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAC;MACnB;GACF;;;EAGD,MAAM,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE,EAAE,EAAE;IAC3B,IAAI,IAAI,CAAC,SAAS,EAAE,OAAO,EAAE,CAAC,IAAI,KAAK,CAAC,sCAAsC,CAAC,CAAC;;IAEhF,IAAI,IAAI,CAAC,SAAS,EAAE;MAClB,IAAI;QACF,IAAI,CAAC,IAAI,CAAC,KAAK,EAAC;OACjB,CAAC,OAAO,GAAG,EAAE;QACZ,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC;OAC1B;MACD,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,mBAAmB,EAAE;;QAEtD,IAAI,CAAC,GAAG,GAAG,GAAE;OACd,MAAM;QACL,EAAE,CAAC,IAAI,EAAC;OACT;KACF,MAAM;;MAEL,IAAI,CAAC,MAAM,GAAG,MAAK;MACnB,IAAI,CAAC,GAAG,GAAG,GAAE;KACd;GACF;;EAED,YAAY,CAAC,GAAG;IACd,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;IAE1B,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,KAAK,KAAK;MAC9B,IAAI,SAAS,GAAG,MAAM;QACpB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;QAC1B,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,YAAY,EAAE,SAAS,GAAE;aAC7C,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,SAAS,EAAC;QAC1C;;MAED,IAAI,SAAS,GAAG,MAAM;QACpB,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,gBAAgB,IAAI,MAAK;;QAE/C,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;UAClB,IAAI,EAAE,MAAM,CAAC,IAAI;UACjB,GAAG,EAAE,MAAM,CAAC,GAAG;SAChB,EAAC;QACH;;MAED,IAAI,OAAO,GAAG,CAAC,GAAG,KAAK;QACrB,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAC;QACnB;;MAED,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;MAC1B,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,EAAC;MACxC,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,KAAK,EAAE,SAAS,EAAE,OAAO,EAAC;KACxD,EAAE,UAAU,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAC,EAAE,EAAE,IAAI,CAAC,gBAAgB,EAAC;GACjE;;EAED,aAAa,CAAC,GAAG;IACf,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;IAE1B,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,MAAM,KAAK;MAChC,IAAI,SAAS,GAAG,MAAM;QACpB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;QAC1B,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,YAAY,EAAE,UAAU,GAAE;aAC9C,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,UAAU,EAAC;QAC3C;;MAED,IAAI,UAAU,GAAG,MAAM;QACrB,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,gBAAgB,IAAI,OAAM;;QAEhD,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;UAClB,IAAI,EAAE,MAAM,CAAC,IAAI;UACjB,GAAG,EAAE,MAAM,CAAC,GAAG;SAChB,EAAC;QACH;;MAED,IAAI,OAAO,GAAG,CAAC,GAAG,KAAK;QACrB,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAC;QACnB;;MAED,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;MAC1B,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,EAAC;MAC1C,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,MAAM,EAAE,SAAS,EAAE,OAAO,EAAC;KACzD,EAAE,UAAU,GAAG,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAC,EAAE,EAAE,IAAI,CAAC,iBAAiB,EAAC;GAClE;;EAED,iBAAiB,CAAC,GAAG;IACnB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;IAC1B,IAAI,kBAAkB,GAAG,IAAI,CAAC,GAAG,CAAC,mBAAkB;IACpD,IAAI,iBAAiB,GAAG,IAAI,CAAC,GAAG,CAAC,kBAAiB;;;;;;;IAOlD,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,kBAAkB,EAAE,iBAAiB,EAAC;;IAElE,IAAI,kBAAkB,KAAK,WAAW,IAAI,kBAAkB,KAAK,WAAW,EAAE;MAC5E,YAAY,CAAC,IAAI,CAAC,iBAAiB,EAAC;MACpC,IAAI,CAAC,QAAQ,GAAG,KAAI;MACpB,IAAI,CAAC,WAAW,GAAE;KACnB;IACD,IAAI,kBAAkB,KAAK,cAAc,EAAE;MACzC,IAAI,IAAI,CAAC,cAAc,EAAE;;QAEvB,YAAY,CAAC,IAAI,CAAC,iBAAiB,EAAC;QACpC,IAAI,CAAC,iBAAiB,GAAG,UAAU,CAAC,YAAY;UAC9C,IAAI,CAAC,QAAQ,GAAE;SAChB,EAAE,IAAI,CAAC,cAAc,EAAC;OACxB,MAAM;QACL,IAAI,CAAC,QAAQ,GAAE;OAChB;KACF;IACD,IAAI,kBAAkB,KAAK,QAAQ,EAAE;MACnC,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,wBAAwB,CAAC,EAAC;KACnD;IACD,IAAI,kBAAkB,KAAK,QAAQ,EAAE;MACnC,IAAI,CAAC,QAAQ,GAAE;KAChB;GACF;;EAED,WAAW,CAAC,GAAG;;IAEb,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,MAAM;;IAEvF,IAAI,CAAC,WAAW,GAAG,KAAI;;;IAGvB,IAAI,iBAAiB,GAAG,MAAM;MAC5B,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;MAE1B,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,KAAK,KAAK;QAC5B,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;;QAG1B,IAAI,GAAG,EAAE,KAAK,GAAG,GAAE;;QAEnB,IAAI,gBAAgB,GAAG,GAAE;QACzB,IAAI,eAAe,GAAG,GAAE;QACxB,IAAI,cAAc,GAAG,GAAE;QACvB,IAAI,0BAA0B,GAAG,MAAK;;QAEtC,IAAI,wBAAwB,GAAG,CAAC,qBAAqB,KAAK;UACxD,0BAA0B,GAAG,KAAI;;UAEjC,IAAI,KAAK,GAAG,eAAe,CAAC,qBAAqB,CAAC,gBAAgB,EAAC;;UAEnE,IAAI,KAAK,IAAI,KAAK,CAAC,EAAE,EAAE;;YAErB,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,GAAE;YAC5B,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,EAAC;WACpC,MAAM,IAAI,KAAK,IAAI,KAAK,CAAC,SAAS,EAAE;;YAEnC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,UAAS;YACnC,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,EAAC;WAC1C,MAAM,IAAI,OAAO,qBAAqB,CAAC,gBAAgB,KAAK,QAAQ,EAAE;;YAErE,KAAK,GAAG,qBAAqB,CAAC,gBAAgB,CAAC,KAAK,CAAC,GAAG,EAAC;YACzD,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,CAAC,EAAC;YAC5B,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,EAAC;WAClC;;UAED,IAAI,MAAM,GAAG,gBAAgB,CAAC,qBAAqB,CAAC,iBAAiB,EAAC;;UAEtE,IAAI,MAAM,IAAI,MAAM,CAAC,EAAE,EAAE;;YAEvB,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC,GAAE;YAC9B,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,EAAC;WACtC,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,SAAS,EAAE;;YAErC,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC,UAAS;YACrC,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,EAAC;WAC5C,MAAM,IAAI,OAAO,qBAAqB,CAAC,iBAAiB,KAAK,QAAQ,EAAE;;YAEtE,MAAM,GAAG,qBAAqB,CAAC,iBAAiB,CAAC,KAAK,CAAC,GAAG,EAAC;YAC3D,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC,CAAC,EAAC;YAC9B,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,EAAC;WACpC;UACD,IAAI,CAAC,YAAY,GAAG,OAAM;;;;;;UAM3B;;QAED,KAAK,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE;;UAE5B,IAAI,IAAI,CAAC,IAAI,KAAK,iBAAiB,IAAI,IAAI,CAAC,IAAI,KAAK,kBAAkB,EAAE;YACvE,gBAAgB,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAI;WACjC;UACD,IAAI,IAAI,CAAC,IAAI,KAAK,gBAAgB,IAAI,IAAI,CAAC,IAAI,KAAK,iBAAiB,EAAE;YACrE,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAI;WAChC;UACD,IAAI,IAAI,CAAC,IAAI,KAAK,eAAe,IAAI,IAAI,CAAC,IAAI,KAAK,gBAAgB,EAAE;YACnE,cAAc,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAI;WAC/B;SACF,EAAC;;QAEF,KAAK,CAAC,OAAO,CAAC,UAAU,IAAI,EAAE;;UAE5B,IAAI,IAAI,CAAC,IAAI,KAAK,WAAW,EAAE;YAC7B,wBAAwB,CAAC,cAAc,CAAC,IAAI,CAAC,uBAAuB,CAAC,EAAC;WACvE;;;UAGD;YACE,CAAC,IAAI,CAAC,IAAI,KAAK,mBAAmB,IAAI,IAAI,CAAC,oBAAoB,KAAK,MAAM;aACzE,CAAC,IAAI,CAAC,IAAI,KAAK,eAAe,IAAI,IAAI,CAAC,IAAI,KAAK,gBAAgB,KAAK,IAAI,CAAC,QAAQ,CAAC;YACpF;YACA,wBAAwB,CAAC,IAAI,EAAC;WAC/B;SACF,EAAC;;QAEF,IAAI,CAAC,0BAA0B,IAAI,KAAK,CAAC,MAAM,EAAE;UAC/C,UAAU,CAAC,iBAAiB,EAAE,GAAG,EAAC;UAClC,MAAM;SACP,MAAM;UACL,IAAI,CAAC,WAAW,GAAG,MAAK;UACxB,IAAI,CAAC,SAAS,GAAG,KAAI;SACtB;;QAED,IAAI,IAAI,CAAC,MAAM,EAAE;UACf,IAAI;YACF,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAC;WACvB,CAAC,OAAO,GAAG,EAAE;YACZ,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC;WAC1B;UACD,IAAI,CAAC,MAAM,GAAG,KAAI;;;UAGlB,IAAI,EAAE,GAAG,IAAI,CAAC,IAAG;UACjB,IAAI,CAAC,GAAG,GAAG,KAAI;UACf,EAAE,CAAC,IAAI,EAAC;SACT;;;;QAID,IAAI,OAAO,IAAI,CAAC,QAAQ,CAAC,0BAA0B,KAAK,QAAQ,EAAE;UAChE,IAAI,CAAC,SAAS,GAAG,WAAW,CAAC,IAAI,CAAC,WAAW,EAAE,GAAG,EAAC;UACnD,IAAI,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,GAAE;SACjD;;;QAGD,IAAI,CAAC,IAAI,CAAC,SAAS,EAAC;QACpB,IAAI,IAAI,CAAC,aAAa,EAAE;UACtB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,aAAa,EAAC;UAC1C,IAAI,CAAC,aAAa,GAAG,KAAI;SAC1B;OACF,EAAC;MACH;IACD,iBAAiB,GAAE;GACpB;;;;EAID,SAAS,CAAC,GAAG;IACX,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;IAE1B,IAAI,IAAI,CAAC,SAAS,EAAE;MAClB,WAAW,GAAE;KACd,MAAM;MACL,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,WAAW,EAAC;KAClC;;;;IAID,SAAS,WAAW,IAAI;MACtB,UAAU,CAAC,YAAY;QACrB,IAAI,CAAC,QAAQ,GAAE;OAChB,EAAE,IAAI,EAAC;KACT;GACF;;EAED,WAAW,CAAC,GAAG;IACb,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,mBAAmB,EAAE;MACrF,MAAM;KACP;IACD,IAAI,CAAC,2BAA2B,GAAE;GACnC;;EAED,uBAAuB,CAAC,GAAG;IACzB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;IAE1B,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,GAAG,CAAC,cAAc,EAAC;GAC3D;;EAED,eAAe,CAAC,CAAC,KAAK,EAAE;IACtB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;IAC1B,IAAI,KAAK,CAAC,SAAS,IAAI,IAAI,CAAC,OAAO,EAAE;MACnC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QAClB,SAAS,EAAE;UACT,SAAS,EAAE,KAAK,CAAC,SAAS,CAAC,SAAS;UACpC,aAAa,EAAE,KAAK,CAAC,SAAS,CAAC,aAAa;UAC5C,MAAM,EAAE,KAAK,CAAC,SAAS,CAAC,MAAM;SAC/B;OACF,EAAC;KACH,MAAM,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE;MAC3B,IAAI,CAAC,YAAY,GAAG,KAAI;MACxB,IAAI,CAAC,IAAI,CAAC,cAAc,EAAC;KAC1B;GACF;;EAED,iBAAiB,CAAC,CAAC,KAAK,EAAE;IACxB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;IAC1B,IAAI,IAAI,GAAG,KAAK,CAAC,KAAI;IACrB,IAAI,IAAI,YAAY,WAAW,EAAE,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,EAAC;IACzD,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,EAAC;GACxB;;EAED,2BAA2B,CAAC,GAAG;IAC7B,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM;;IAEvC,IAAI,EAAE,GAAG,IAAI,CAAC,IAAG;IACjB,IAAI,CAAC,GAAG,GAAG,KAAI;IACf,EAAE,CAAC,IAAI,EAAC;GACT;;EAED,cAAc,CAAC,GAAG;IAChB,IAAI,IAAI,GAAG,KAAI;IACf,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;IAE5C,IAAI,CAAC,aAAa,GAAG,KAAI;IACzB,IAAI,CAAC,WAAW,GAAE;GACnB;;EAED,eAAe,CAAC,GAAG;IACjB,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;;IAE1B,IAAI,CAAC,QAAQ,GAAE;GAChB;;EAED,QAAQ,CAAC,CAAC,KAAK,EAAE;IACf,IAAI,IAAI,CAAC,SAAS,EAAE,MAAM;IAC1B,IAAI,CAAC,MAAM,CAAC,UAAU,EAAC;IACvB,IAAI,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAE;IAC5B,IAAI,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,MAAM;IACpD,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE,EAAC;IAC9B,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,EAAC;GACtC;;EAED,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,GAAG,EAAC,EAAE;CACzD;;AAED,SAAS,IAAI,IAAI,EAAE;;;;"}